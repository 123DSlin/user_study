<!-- Netlify表单模板 - 更新HTML文件时必须包含此部分 -->
<!-- 位置：在<body>标签开始后立即添加 -->
<form name="user-study-results" netlify netlify-honeypot="bot-field" style="display: none;">
    <input type="hidden" name="form-name" value="user-study-results">
    <input type="hidden" name="timestamp">
    <input type="hidden" name="userGroup">
    <input type="hidden" name="language">
    <input type="hidden" name="totalTime">
    <input type="hidden" name="score">
    <input type="hidden" name="totalQuestions">
    <input type="hidden" name="questionTimes">
    <input type="hidden" name="answers">
    <input type="hidden" name="surveyQ1">
    <input type="hidden" name="surveyQ2">
    <input type="hidden" name="bot-field">
</form>

<!-- JavaScript表单提交代码模板 -->
<script>
// 表单提交函数 - 必须包含此函数
function submitToNetlify(testData) {
    const formData = new FormData();
    formData.append('form-name', 'user-study-results');
    formData.append('timestamp', testData.timestamp);
    formData.append('userGroup', testData.userGroup);
    formData.append('language', testData.language);
    formData.append('totalTime', testData.totalTime || '0');
    formData.append('score', testData.score || '0');
    formData.append('totalQuestions', testData.totalQuestions || '0');
    formData.append('questionTimes', JSON.stringify(testData.questionTimes || []));
    formData.append('answers', JSON.stringify(testData.answers || []));
    formData.append('surveyQ1', testData.survey.question1 || '');
    formData.append('surveyQ2', testData.survey.question2 || '');
    formData.append('bot-field', ''); // honeypot field
    
    // 提交数据到Netlify Forms
    fetch('/', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (response.ok) {
            console.log('数据已成功提交到Netlify Forms');
            showSurveySuccess();
            setTimeout(() => {
                showSurveyComplete(testData);
            }, 2000);
        } else {
            console.error('提交失败:', response.status);
            showSurveyError();
            setTimeout(() => {
                showSurveyComplete(testData);
            }, 3000);
        }
    })
    .catch(error => {
        console.error('提交错误:', error);
        showSurveyComplete(testData);
    });
}
</script>
